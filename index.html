<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadrifogli con D3.js</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .leaf {
            stroke: black;
            stroke-width: 2px;
        }
    </style>
</head>
<body>
    <svg width="1000" height="1000"></svg>

    <script>
        d3.json("data.json").then(function(data) {
            const svg = d3.select("svg");

            // Trova il valore massimo tra tutte le variabili
            const maxVariableValue = d3.max(data, d => d3.max(Object.values(d)));

            function draw(data) {
                const leaves = svg.selectAll(".leaf")
                .data(data)
                .enter()
                .append("g")
                .attr("class", "leaf")
                .each(function(d) {
                    const group = d3.select(this);
                    const factorScale = 1000;
                    const sizeFactor = 1.5;         // Fattore di scala per la dimensione del quadrifoglio
                    
                    /* scala per i valori */
                    var scale =d3.scaleLinear();
                    scale.domain([0, maxVariableValue])
                    scale.range([50, 1000])

                    const newX = scale(d.var1*Math.random(factorScale))
                    const newY = scale(d.var1*Math.random(factorScale))

                    /*Foglia in basso a sinistra */
                    group.append("path")
                        .attr("transform", `translate(${newX-50},${newY-45}) scale(${sizeFactor})`)
                        .attr("d", "M3.8 40c-5.9 9.8 4.3 12.8 8.8 9.5c-3.4 5-.1 14.4 9.7 8.7c10.9-6.4 7.9-24.5 8.5-26.6c-1.8.3-20.7-2.1-27 8.4")
                        .attr("fill", "#7bb246")
                        .on("click", function(event, d) {
                            const newX = (d.var1 / maxVariableValue) * 1000;
                            const newY = parseFloat(this.parentNode.children[4].getAttribute("cy"));   

                            group.selectAll("circle")
                                .transition()
                                .duration(1000)
                                .attr("cx", newX)
                                .attr("cy", newY);

                            group.selectAll("path")
                                .transition()
                                .duration(1000)
                                .attr("transform", `translate(${newX-50},${newY-45}) scale(${sizeFactor})`)
                        })
                        .on("dblclick", function(event, d) {
                            const newX = parseFloat(this.parentNode.children[4].getAttribute("cx"));
                            const newY = (d.var1 / maxVariableValue) * 1000;

                            group.selectAll("circle")
                                .transition()
                                .duration(1000)
                                .attr("cx", newX)
                                .attr("cy", newY);

                            group.selectAll("path")
                                .transition()
                                .duration(1000)
                                .attr("transform", `translate(${newX-50},${newY-45}) scale(${sizeFactor})`)
                        });

                    group.append("path")
                        .attr("transform", `translate(${newX-50},${newY-45}) scale(${sizeFactor})`)
                        .attr("d", "M60.2 22c5.9-9.8-4.3-12.8-8.8-9.5c3.4-5 .1-14.4-9.7-8.7c-10.9 6.4-7.9 24.5-8.5 26.6c1.8-.3 20.7 2.1 27-8.4")
                        .attr("fill", "#7bb246");
                    group.append("path")
                        .attr("transform", `translate(${newX-50},${newY-45}) scale(${sizeFactor})`)
                        .attr("d", "M22.3 3.8c-10-5.8-13 4.2-9.7 8.7c-5-3.3-14.6-.1-8.8 9.5c6.5 10.7 24.9 7.8 27 8.3c-.3-1.7 2.2-20.3-8.5-26.5")
                        .attr("fill", "#83bf4f");
                    group.append("path")
                        .attr("transform", `translate(${newX-50},${newY-45}) scale(${sizeFactor})`)
                        .attr("d", "M41.7 58.2c10 5.8 13-4.2 9.7-8.7c5.1 3.3 14.6.1 8.8-9.5c-6.5-10.7-24.9-7.8-27-8.3c.3 1.7-2.2 20.3 8.5 26.5")
                        .attr("fill", "#83bf4f");
                    group.append("circle")
                        .attr("cx", newX-2)           // sposta la coordinata x in base al valore di var1
                        .attr("cy", newY+1)           // sposta la coordinata y in base al valore di var2
                        .attr("r", 8) 
                        .attr("fill", "#699635");
                });
            }

            draw(data);
        });
    </script>
</body>
</html>
